{"version":3,"sources":["../src/ithoughts_tt_gl-editor.js"],"names":["initTinyMCEPlugin","ithoughts","$d","ready","onDocumentReady","$","itg","iThoughtsTooltipGlossary","itge","iThoughtsTooltipGlossaryEditor","stripQuotes","prefix3","prefix4","tipsTypes","htmlAttrs","isNA","editor","initLoggers","verbosity","removeAccents","s","translateRegex","translate","a","A","c","C","e","E","g","G","i","I","l","L","n","N","o","O","r","R","S","u","U","z","Z","replace","doReplace","match","replaceShortcodes","content","repLength","replaceShortcodesEl","length","restoreShortcodes","resLength","restoreShortcodesEl","replaceShortcodeElGlossary","all","balise","inner","text","attrs","regex","matched","ret","glossary","tooltip","mediatip","Boolean","exec","hasOwnProperty","indexOf","replaceShortcodeElList","type","attrStr","restoreShortcodeElGlossary","b","term","restoreShortcodeElList","editorForms","list","selection","callback","log","mode","node","start","values","alpha","group","loader","trimFilter","attrsStr","split","map","Function","prototype","call","String","trim","filter","filterNonNullAttr","end","nodeName","extend","getAttribute","cols","parseInt","desc","makeLoader","ajax","method","async","url","admin_ajax","data","action","_wpnonce","nonce","success","out","remove","newDom","parseHTML","document","body","append","css","opacity","animate","finishListTinymce","domC","handleFormSubmitted","info","animateEnd","shortcode","atoz","tail","optsStrs","addOpt","label","value","specEncode","push","generateAttr","filterNoNA","val","concat","attr","finalContent","join","error","arguments","tip","escapeContent","atts","attsLength","att","takeAttr","positionAt","positionMy","myInverted","tristate","html","attributes","nodeValue","nodata","Math","max","invert","undefined","tooltipContent","link","tooltip_content","glossary_id","term_search","toLowerCase","mediatip_type","mediatip_content","mediatip_link","mediatip_caption","opts","termcontent","qtiprounded","qtipshadow","qtipstyle","qtiptrigger","position","at","my","span","anim","in","time","maxwidth","glossary_disable_auto_translation","finishTipTinymce","animateAfter","attributesList","find","domToValue","toArray","types","typesLength","j","prefix","midPart","optsAttrs","reverse","startsWith","encodeURI","disable_auto_translation","xhr","status","getLang","dialog","title","modale","generateSelObject","txtarea","get","sel","substring","selectionStart","selectionEnd","DOM","first","last","QTags","addButton","onClickButton","insertContent","iThoughts","v5"],"mappings":"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","file":"ithoughts_tt_gl-editor.js","sourcesContent":["/**\n * @file Script loaded as soon a post editor is opened. It contains all basic functions to insert shortcodes\n *\n * @author Gerkin\n * @copyright 2016 GerkinDevelopment\n * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3\n * @package ithoughts-tooltip-glossary\n *\n * @version 2.7.0\n */\n\n/*global QTags: false, iThoughtsTooltipGlossaryEditor: false */\n\n'use strict';\n\n/**\n * @function initTinyMCEPlugin\n * @description Namespace & register both term & list TinyMCE plugins for iThoughts Tooltip Glossary\n * @param {Object} ithoughts Appropriate version of iThoughts Tooltip Glossary helper\n */\n( function initTinyMCEPlugin( ithoughts ) {\n\tithoughts.$d.ready( function onDocumentReady() {\n\t\tvar $    \t\t\t= ithoughts.$,\n\t\t\titg\t\t\t\t= iThoughtsTooltipGlossary,\n\t\t\titge\t\t\t= iThoughtsTooltipGlossaryEditor,\n\t\t\tstripQuotes\t\t= itg.stripQuotes,\n\t\t\tprefix3\t\t\t= 'ithoughts-tooltip-glossary',\n\t\t\tprefix4\t\t\t= 'itg',\n\t\t\ttipsTypes\t\t= [ 'ithoughts-tooltip-glossary-term', 'ithoughts-tooltip-glossary-tooltip', 'ithoughts-tooltip-glossary-mediatip' ],\n\t\t\thtmlAttrs\t\t= [ 'href' ],\n\t\t\tisNA\t\t\t= ithoughts.isNA,\n\t\t\teditor\t\t\t= itge.editor;\n\n\t\tithoughts.initLoggers( itge, 'iThoughts Tooltip Glossary', itge.verbosity );\n\t\titge.removeAccents = function removeAccents( s ) {\n\t\t\tvar translateRegex\t= /[¹²³áàâãäåaaaÀÁÂÃÄÅAAAÆccç©CCÇÐÐèéê?ëeeeeeÈÊË?EEEEE€gGiìíîïìiiiÌÍÎÏ?ÌIIIlLnnñNNÑòóôõöoooøÒÓÔÕÖOOOØŒr®Ršs?ßŠS?ùúûüuuuuÙÚÛÜUUUUýÿÝŸžzzŽZZ]/g,\n\t\t\t\ttranslate\t\t= {\n\t\t\t\t\t'¹': '1',\n\t\t\t\t\t'²': '2',\n\t\t\t\t\t'³': '3',\n\t\t\t\t\t'á': 'a',\n\t\t\t\t\t'à': 'a',\n\t\t\t\t\t'â': 'a',\n\t\t\t\t\t'ã': 'a',\n\t\t\t\t\t'ä': 'a',\n\t\t\t\t\t'å': 'a',\n\t\t\t\t\ta:   'a',\n\t\t\t\t\t'À': 'a',\n\t\t\t\t\t'Á': 'a',\n\t\t\t\t\t'Â': 'a',\n\t\t\t\t\t'Ã': 'a',\n\t\t\t\t\t'Ä': 'a',\n\t\t\t\t\t'Å': 'a',\n\t\t\t\t\tA:   'a',\n\t\t\t\t\t'Æ': 'a',\n\t\t\t\t\tc:   'c',\n\t\t\t\t\t'ç': 'c',\n\t\t\t\t\t'©': 'c',\n\t\t\t\t\tC:   'c',\n\t\t\t\t\t'Ç': 'c',\n\t\t\t\t\t'Ð': 'd',\n\t\t\t\t\t'è': 'e',\n\t\t\t\t\t'é': 'e',\n\t\t\t\t\t'ê': 'e',\n\t\t\t\t\t'?': 's',\n\t\t\t\t\t'ë': 'e',\n\t\t\t\t\te:   'e',\n\t\t\t\t\t'È': 'e',\n\t\t\t\t\t'Ê': 'e',\n\t\t\t\t\t'Ë': 'e',\n\t\t\t\t\tE:   'e',\n\t\t\t\t\t'€': 'e',\n\t\t\t\t\tg:   'g',\n\t\t\t\t\tG:   'g',\n\t\t\t\t\ti:   'i',\n\t\t\t\t\t'ì': 'i',\n\t\t\t\t\t'í': 'i',\n\t\t\t\t\t'î': 'i',\n\t\t\t\t\t'ï': 'i',\n\t\t\t\t\t'Ì': 'i',\n\t\t\t\t\t'Í': 'i',\n\t\t\t\t\t'Î': 'i',\n\t\t\t\t\t'Ï': 'i',\n\t\t\t\t\tI:   'i',\n\t\t\t\t\tl:   'l',\n\t\t\t\t\tL:   'l',\n\t\t\t\t\tn:   'n',\n\t\t\t\t\t'ñ': 'n',\n\t\t\t\t\tN:   'n',\n\t\t\t\t\t'Ñ': 'n',\n\t\t\t\t\t'ò': 'o',\n\t\t\t\t\t'ó': 'o',\n\t\t\t\t\t'ô': 'o',\n\t\t\t\t\t'õ': 'o',\n\t\t\t\t\t'ö': 'o',\n\t\t\t\t\to:   'o',\n\t\t\t\t\t'ø': 'o',\n\t\t\t\t\t'Ò': 'o',\n\t\t\t\t\t'Ó': 'o',\n\t\t\t\t\t'Ô': 'o',\n\t\t\t\t\t'Õ': 'o',\n\t\t\t\t\t'Ö': 'o',\n\t\t\t\t\tO:   'o',\n\t\t\t\t\t'Ø': 'o',\n\t\t\t\t\t'Œ': 'o',\n\t\t\t\t\tr:   'r',\n\t\t\t\t\t'®': 'r',\n\t\t\t\t\tR:   'r',\n\t\t\t\t\t'š': 's',\n\t\t\t\t\ts:   's',\n\t\t\t\t\t'ß': 's',\n\t\t\t\t\t'Š': 's',\n\t\t\t\t\tS:   's',\n\t\t\t\t\t'ù': 'u',\n\t\t\t\t\t'ú': 'u',\n\t\t\t\t\t'û': 'u',\n\t\t\t\t\t'ü': 'u',\n\t\t\t\t\tu:   'u',\n\t\t\t\t\t'Ù': 'u',\n\t\t\t\t\t'Ú': 'u',\n\t\t\t\t\t'Û': 'u',\n\t\t\t\t\t'Ü': 'u',\n\t\t\t\t\tU:   'u',\n\t\t\t\t\t'ý': 'y',\n\t\t\t\t\t'ÿ': 'y',\n\t\t\t\t\t'Ý': 'y',\n\t\t\t\t\t'Ÿ': 'y',\n\t\t\t\t\t'ž': 'z',\n\t\t\t\t\tz:   'z',\n\t\t\t\t\t'Ž': 'z',\n\t\t\t\t\tZ:   'z',\n\t\t\t\t};\n\t\t\treturn s.replace( translateRegex, function doReplace( match ) {\n\t\t\t\treturn translate[match];\n\t\t\t});\n\t\t};\n\n\t\titge.replaceShortcodes = function replaceShortcodes( content ) {\n\t\t\tvar repLength = itge.replaceShortcodesEl.length,\n\t\t\t\ti = -1;\n\t\t\twhile (( i += 1 ) < repLength ) {\n\t\t\t\tcontent = itge.replaceShortcodesEl[i]( content );\n\t\t\t}\n\t\t\treturn content;\n\t\t};\n\t\titge.restoreShortcodes = function restoreShortcodes( content ) {\n\t\t\tvar resLength = itge.restoreShortcodesEl.length,\n\t\t\t\ti = -1;\n\t\t\twhile (( i += 1 ) < resLength ) {\n\t\t\t\tcontent = itge.restoreShortcodesEl[i]( content );\n\t\t\t}\n\t\t\treturn content;\n\t\t};\n\t\titge.replaceShortcodesEl = [\n\t\t\tfunction replaceShortcodeElGlossary( content ) { // For [glossary]\n\t\t\t\treturn content.replace( /\\[(?:itg-)?(glossary|tooltip|mediatip)(?!_)(.*?)\\](.*?)\\[\\/(?:itg-)?(glossary|tooltip|mediatip)\\]/g, function doReplace( all, balise, inner, text ) {\n\t\t\t\t\tvar attrs\t= {},\n\t\t\t\t\t\tregex\t= /([\\w\\d\\-]+?)=\"(.+?)\"/g,\n\t\t\t\t\t\tmatched\t= null,\n\t\t\t\t\t\tret\t\t= `<a data-type=\"${  prefix3  }-${  {\n\t\t\t\t\t\t\tglossary: 'term',\n\t\t\t\t\t\t\ttooltip:  'tooltip',\n\t\t\t\t\t\t\tmediatip: 'mediatip',\n\t\t\t\t\t\t}[balise]  }\"`,\n\t\t\t\t\t\ti;\n\t\t\t\t\twhile ( true === Boolean( matched = regex.exec( inner ))) {\n\t\t\t\t\t\tattrs[matched[1]] = matched[2];\n\t\t\t\t\t}\n\t\t\t\t\tfor ( i in attrs ) {\n\t\t\t\t\t\tif ( attrs.hasOwnProperty( i )) {\n\t\t\t\t\t\t\tif ( htmlAttrs.indexOf( i ) > -1 || 0 === i.indexOf( 'data-' )) {\n\t\t\t\t\t\t\t\tret += ` ${  i  }=\"${  attrs[i]  }\"`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tret += ` data-${  i  }=\"${  attrs[i]  }\"`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn `${ ret  }>${  text  }</a>`;\n\t\t\t\t});\n\t\t\t},\n\t\t\tfunction replaceShortcodeElList( content ) { // For [glossary_(term_list|atoz)]\n\t\t\t\treturn content.replace( /\\[glossary_(term_list|atoz)(.*?)\\/\\]/g, function doReplace( all, type, attrStr ) {\n\t\t\t\t\tvar attrs\t= {},\n\t\t\t\t\t\tregex\t= /([\\w\\d\\-]+?)=\"(.+?)\"/g,\n\t\t\t\t\t\tmatched\t= null,\n\t\t\t\t\t\tret\t\t= `<span data-type=\"${  prefix3  }-${  type  }\"`,\n\t\t\t\t\t\ti;\n\t\t\t\t\twhile ( true === Boolean( matched = regex.exec( attrStr ))) {\n\t\t\t\t\t\tattrs[matched[1]] = matched[2];\n\t\t\t\t\t}\n\t\t\t\t\tfor ( i in attrs ) {\n\t\t\t\t\t\tif ( attrs.hasOwnProperty( i )) {\n\t\t\t\t\t\t\tif ( htmlAttrs.indexOf( i ) > -1 || 0 === i.indexOf( 'data-' )) {\n\t\t\t\t\t\t\t\tret += ` ${  i  }=\"${  attrs[i]  }\"`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tret += ` data-${  i  }=\"${  attrs[i]  }\"`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn `${ ret  }>Glossary ${  ( 'term_list' === type ) ? 'List' : 'A-to-Z'  }</span>`;\n\t\t\t\t});\n\t\t\t},\n\t\t];\n\t\titge.restoreShortcodesEl = [\n\t\t\tfunction restoreShortcodeElGlossary( content ) { // For [glossary]\n\t\t\t\treturn content.replace( /<a\\s+(?=[^>]*data-type=\"ithoughts-tooltip-glossary-(term|tooltip|mediatip)\")(.*?)>(.*?)<\\/a>/g, function doReplace( all, type, inner, text ) {\n\t\t\t\t\tvar attrs\t= {},\n\t\t\t\t\t\tregex\t= /(data-)?([\\w\\d\\-]+?)=\"(.+?)\"/g,\n\t\t\t\t\t\tmatched\t= null,\n\t\t\t\t\t\tb\t\t= {\n\t\t\t\t\t\t\tterm:     'glossary',\n\t\t\t\t\t\t\ttooltip:  'tooltip',\n\t\t\t\t\t\t\tmediatip: 'mediatip',\n\t\t\t\t\t\t}[type],\n\t\t\t\t\t\tret\t\t= `[${  prefix4  }-${  b }`,\n\t\t\t\t\t\ti;\n\t\t\t\t\twhile ( true === Boolean( matched = regex.exec( inner ))) {\n\t\t\t\t\t\tif ( matched[1] !== 'data-' || matched[2] !== 'type' ) {\n\t\t\t\t\t\t\tif ( htmlAttrs.indexOf( matched[2]) > -1 && typeof matched[1] !== 'undefined' ) {\n\t\t\t\t\t\t\t\tattrs[matched[1] + matched[2]] = matched[3];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tattrs[matched[2]] = matched[3];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor ( i in attrs ) {\n\t\t\t\t\t\tif ( attrs.hasOwnProperty( i )) {\n\t\t\t\t\t\t\tret += ` ${  i  }=\"${  attrs[i]  }\"`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn `${ ret  }]${  text  }[/${  prefix4  }-${  b  }]`;\n\t\t\t\t});\n\t\t\t},\n\t\t\tfunction restoreShortcodeElList( content ) { // For [glossary_(term_list|atoz)]\n\t\t\t\treturn content.replace( /<span\\s+(?=[^>]*data-type=\"ithoughts-tooltip-glossary-(term_list|atoz)\")(.*?)>.*?<\\/span>/g, function doReplace( all, type, attrStr ) {\n\t\t\t\t\tvar attrs\t= {},\n\t\t\t\t\t\tregex\t= /(data-)?([\\w\\d\\-]+?)=\"(.+?)\"/g,\n\t\t\t\t\t\tmatched\t= null,\n\t\t\t\t\t\tret\t\t= `[glossary_${  type }`,\n\t\t\t\t\t\ti;\n\t\t\t\t\twhile ( true === Boolean( matched = regex.exec( attrStr ))) {\n\t\t\t\t\t\tif ( matched[1] !== 'data-' || matched[2] !== 'type' ) {\n\t\t\t\t\t\t\tif ( htmlAttrs.indexOf( i ) > -1 && typeof matched[1] !== 'undefined' ) {\n\t\t\t\t\t\t\t\tattrs[matched[1] + matched[2]] = matched[3];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tattrs[matched[2]] = matched[3];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor ( i in attrs ) {\n\t\t\t\t\t\tif ( attrs.hasOwnProperty( i )) {\n\t\t\t\t\t\t\tret += ` ${  i  }=\"${  attrs[i]  }\"`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn `${ ret  }/]`;\n\t\t\t\t});\n\t\t\t},\n\t\t];\n\n\t\titge.editorForms = {\n\t\t\tlist: function list( selection, callback ) {\n\t\t\t\titge.log( 'Selection infos to load TIP: ', selection );\n\t\t\t\tvar mode = 'insert_content',\n\t\t\t\t\tnode\t= selection.start,\n\t\t\t\t\tvalues = {\n\t\t\t\t\t\ttype:  'atoz',\n\t\t\t\t\t\talpha: [],\n\t\t\t\t\t\tgroup: [],\n\t\t\t\t\t},\n\t\t\t\t\tloader;\n\t\t\t\tfunction trimFilter( attrsStr ) {\n\t\t\t\t\treturn ( attrsStr||'' ).split( ',' ).map( Function.prototype.call, String.prototype.trim ).filter( function filterNonNullAttr( e ) {\n\t\t\t\t\t\treturn e;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif ( !isNA( selection.start ) && selection.start === selection.end ) {\n\t\t\t\t\titge.log( `Start & End node are the same, operating on a node of type ${  node.nodeName }` );\n\t\t\t\t\tif ( node && node.nodeName !== '#text' ) {\n\t\t\t\t\t\t$.extend( values, {\n\t\t\t\t\t\t\talpha: trimFilter( node.getAttribute( 'data-alpha' )),\n\t\t\t\t\t\t\tgroup: trimFilter( node.getAttribute( 'data-group' )),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif ( 'ithoughts-tooltip-glossary-atoz' === node.getAttribute( 'data-type' )) { // Is atoz\n\t\t\t\t\t\t\tmode = 'load';\n\t\t\t\t\t\t\tvalues.type = 'atoz';\n\t\t\t\t\t\t} else if ( 'ithoughts-tooltip-glossary-term_list' === node.getAttribute( 'data-type' )) { // Is term_list\n\t\t\t\t\t\t\tmode = 'load';\n\t\t\t\t\t\t\tvalues.type = 'list';\n\t\t\t\t\t\t\t$.extend( values, {\n\t\t\t\t\t\t\t\tcols: parseInt( node.getAttribute( 'data-cols' )),\n\t\t\t\t\t\t\t\tdesc: node.getAttribute( 'data-desc' ),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Then generate form through Ajax\n\t\t\t\tloader = ithoughts.makeLoader();\n\t\t\t\t$.ajax({\n\t\t\t\t\tmethod:\t'POST',\n\t\t\t\t\tasync:  true,\n\t\t\t\t\turl:    itge.admin_ajax,\n\t\t\t\t\tdata:   {\n\t\t\t\t\t\taction:   'ithoughts_tt_gl_get_tinymce_list_form',\n\t\t\t\t\t\tdata:     values,\n\t\t\t\t\t\t_wpnonce: itge.nonce,\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: function success( out ) {\n\t\t\t\t\t\tloader.remove();\n\t\t\t\t\t\tvar newDom = $( $.parseHTML( out, true ));\n\n\t\t\t\t\t\t$( document.body ).append( newDom.css({\n\t\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\t}).animate({\n\t\t\t\t\t\t\topacity: 1,\n\t\t\t\t\t\t}, 500 ));\n\n\n\t\t\t\t\t\titge.finishListTinymce = ( function finishListTinymce() {\n\t\t\t\t\t\t\tvar domC = newDom;\n\t\t\t\t\t\t\treturn function handleFormSubmitted( data ) {\n\t\t\t\t\t\t\t\titge.info( 'New list data:', data );\n\t\t\t\t\t\t\t\tdomC.animate({\n\t\t\t\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\t\t\t}, 500, function animateEnd() {\n\t\t\t\t\t\t\t\t\tdomC.remove();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif ( 'undefined' === typeof data ) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tvar shortcode = `glossary_${  ({\n\t\t\t\t\t\t\t\t\t\tatoz: 'atoz',\n\t\t\t\t\t\t\t\t\t\tlist: 'term_list',\n\t\t\t\t\t\t\t\t\t})[data.type] }`,\n\t\t\t\t\t\t\t\t\ttail = ( mode !== 'load' ) ? ' ' : '',\n\t\t\t\t\t\t\t\t\toptsStrs\t\t= [],\n\t\t\t\t\t\t\t\t\taddOpt\t\t\t= function addOpt( label, value, specEncode ) {\n\t\t\t\t\t\t\t\t\t\toptsStrs.push( generateAttr( label, value, specEncode ));\n\t\t\t\t\t\t\t\t\t\toptsStrs = optsStrs.filter( function filterNoNA( val ) {\n\t\t\t\t\t\t\t\t\t\t\treturn !isNA( val );\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t};\n\n\n\t\t\t\t\t\t\t\tvar attrs = [ 'alpha', 'group' ];\n\t\t\t\t\t\t\t\tswitch ( data.type ) {\n\t\t\t\t\t\t\t\t\tcase 'list': {\n\t\t\t\t\t\t\t\t\t\tattrs = attrs.concat([ 'cols', 'desc' ]);\n\t\t\t\t\t\t\t\t\t} break;\n\t\t\t\t\t\t\t\t\t\t\t\t   }\n\n\t\t\t\t\t\t\t\tfor ( var i = 0, I = attrs.length; i < I; i++ ) {\n\t\t\t\t\t\t\t\t\tvar attr = attrs[i];\n\t\t\t\t\t\t\t\t\tif ( data.hasOwnProperty( attr )) {\n\t\t\t\t\t\t\t\t\t\taddOpt( attr, data[attr]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tvar finalContent = `[${  shortcode  } ${  optsStrs.join( ' ' )  }/]${  tail }`;\n\t\t\t\t\t\t\t\titge.log( 'Final content:', finalContent );\n\t\t\t\t\t\t\t\treturn callback( finalContent, mode );\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}());\n\t\t\t\t\t},\n\t\t\t\t\terror: function error() {\n\t\t\t\t\t\tloader.remove();\n\t\t\t\t\t\titge.error( 'Error while getting TinyMCE form for Tip: ', arguments );\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\ttip: function tip( selection, callback, escapeContent ) {\n\t\t\t\titge.info( 'Selection infos to load TIP: ', selection );\n\t\t\t\tvar values\t= {},\n\t\t\t\t\tnode\t= selection.start,\n\t\t\t\t\tmode\t= '',\n\t\t\t\t\ti\t\t= -1,\n\t\t\t\t\tcontent,\n\t\t\t\t\tatts,\n\t\t\t\t\tattsLength,\n\t\t\t\t\tattrs,\n\t\t\t\t\tatt,\n\t\t\t\t\ttakeAttr,\n\t\t\t\t\tpositionAt,\n\t\t\t\t\tpositionMy,\n\t\t\t\t\tmyInverted,\n\t\t\t\t\ttristate,\n\t\t\t\t\tloader;\n\t\t\t\tif ( !isNA( selection.start ) && selection.start === selection.end ) {\n\t\t\t\t\titge.log( `Start & End node are the same, operating on a node of type ${  node.nodeName }` );\n\t\t\t\t\tcontent = ( node && node.text ) || selection.html; // Get node text if any or get selection\n\t\t\t\t\titge.log( 'Loading content: ', content );\n\t\t\t\t\tif ( node && node.nodeName !== '#text' && tipsTypes.indexOf( node.getAttribute( 'data-type' )) > -1 ) { // On Glossary Term or Tooltip or Mediatip, load data\n\t\t\t\t\t\tmode = 'load';\n\t\t\t\t\t\tattrs = {};\n\t\t\t\t\t\tatts = node.attributes;\n\t\t\t\t\t\tattsLength = atts.length;\n\t\t\t\t\t\twhile (( i += 1 ) < attsLength ) {\n\t\t\t\t\t\t\tatt = atts[i];\n\t\t\t\t\t\t\tattrs[att.nodeName] = att.nodeValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttakeAttr = function takeAttr( label, nodata ) {\n\t\t\t\t\t\t\tif ( isNA( nodata ) || !nodata ) {\n\t\t\t\t\t\t\t\tlabel = `data-${  label }`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar val = attrs[label];\n\t\t\t\t\t\t\tdelete attrs[label];\n\t\t\t\t\t\t\treturn val;\n\t\t\t\t\t\t};\n\n\n\t\t\t\t\t\tpositionAt = ( takeAttr( 'position-at' ) || ' ' ).split( ' ' );\n\t\t\t\t\t\tpositionMy = ( takeAttr( 'position-my' ) || ' ' ).split( ' ' );\n\t\t\t\t\t\tmyInverted = ( 1 === Math.max( positionMy.indexOf( 'top' ), positionMy.indexOf( 'bottom' ))) || ( 0 === Math.max( positionMy.indexOf( 'right' ), positionMy.indexOf( 'left' )));\n\t\t\t\t\t\tpositionAt = {\n\t\t\t\t\t\t\t1: positionAt[0],\n\t\t\t\t\t\t\t2: positionAt[1],\n\t\t\t\t\t\t};\n\t\t\t\t\t\tpositionMy = {\n\t\t\t\t\t\t\t1:      positionMy[myInverted ? 1 : 0],\n\t\t\t\t\t\t\t2:      positionMy[myInverted ? 0 : 1],\n\t\t\t\t\t\t\tinvert: myInverted ? 'enabled' : undefined,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\ttristate = function tristate( val ) {\n\t\t\t\t\t\t\tif ( 'true' === val ) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ( 'false' === val ) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tvar tooltipContent = takeAttr( 'tooltip-content' );\n\t\t\t\t\t\tif ( escapeContent && tooltipContent ) {\n\t\t\t\t\t\t\ttooltipContent = tooltipContent.replace( /&lt;/g, '<' ).replace( /&gt;/g, '>' );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvalues = {\n\t\t\t\t\t\t\ttext:             content,\n\t\t\t\t\t\t\tlink:             takeAttr( 'href', true ),\n\t\t\t\t\t\t\ttooltip_content:  stripQuotes( tooltipContent || content, false ),\n\t\t\t\t\t\t\tglossary_id:      takeAttr( 'glossary-id' ),\n\t\t\t\t\t\t\tterm_search:      itge.removeAccents( content.toLowerCase()),\n\t\t\t\t\t\t\tmediatip_type:    takeAttr( 'mediatip-type' ),\n\t\t\t\t\t\t\tmediatip_content: stripQuotes( takeAttr( 'mediatip-content' ), false ),\n\t\t\t\t\t\t\tmediatip_link:    takeAttr( 'mediatip-link' ),\n\t\t\t\t\t\t\tmediatip_caption: takeAttr( 'mediatip-caption' ),\n\t\t\t\t\t\t\ttype:             [ 'glossary', 'tooltip', 'mediatip' ][tipsTypes.indexOf( takeAttr( 'type' ))],\n\t\t\t\t\t\t\topts:             {\n\t\t\t\t\t\t\t\ttermcontent:      takeAttr( 'termcontent' ),\n\t\t\t\t\t\t\t\t'qtip-keep-open': 'true' === takeAttr( 'qtip-keep-open' ),\n\t\t\t\t\t\t\t\tqtiprounded:      tristate( takeAttr( 'qtiprounded' )),\n\t\t\t\t\t\t\t\tqtipshadow:       tristate( takeAttr( 'qtipshadow' )),\n\t\t\t\t\t\t\t\tqtipstyle:        takeAttr( 'qtipstyle' ),\n\t\t\t\t\t\t\t\tqtiptrigger:      takeAttr( 'qtiptrigger' ),\n\t\t\t\t\t\t\t\tposition:         {\n\t\t\t\t\t\t\t\t\tat:\tpositionAt,\n\t\t\t\t\t\t\t\t\tmy:\tpositionMy,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tattributes:\t{\n\t\t\t\t\t\t\t\t\tspan: {},\n\t\t\t\t\t\t\t\t\tlink:\t{},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tanim: {\n\t\t\t\t\t\t\t\t\tin:   takeAttr( 'animation_in' ),\n\t\t\t\t\t\t\t\t\tout:  takeAttr( 'animation_out' ),\n\t\t\t\t\t\t\t\t\ttime: takeAttr( 'animation_time' ),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmaxwidth: takeAttr( 'tooltip-maxwidth' ),\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t\tglossary_disable_auto_translation: 'true' === ( takeAttr( 'disable_auto_translation' ) || false ),\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfor ( i in attrs ) {\n\t\t\t\t\t\t\tif ( attrs.hasOwnProperty( i )) {\n\t\t\t\t\t\t\t\tif ( i.match( /^data-link-/ )) {\n\t\t\t\t\t\t\t\t\tvalues.opts.attributes.link[i.replace( /^data-link-(data-)?/, '' )] = attrs[i];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvalues.opts.attributes.span[i.replace( /^data-/, '' )] = attrs[i];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Create new glossary term\n\t\t\t\t\t\tvalues\t= {\n\t\t\t\t\t\t\ttext:             '',\n\t\t\t\t\t\t\tlink:             '',\n\t\t\t\t\t\t\ttooltip_content:  '',\n\t\t\t\t\t\t\tglossary_id:      null,\n\t\t\t\t\t\t\tterm_search:      '',\n\t\t\t\t\t\t\tmediatip_type:    '',\n\t\t\t\t\t\t\tmediatip_content: '',\n\t\t\t\t\t\t\tmediatip_caption: '',\n\t\t\t\t\t\t\ttype:             'tooltip',\n\n\t\t\t\t\t\t\tglossary_disable_auto_translation:\tfalse,\n\t\t\t\t\t\t};\n\t\t\t\t\t\t// If something is selected, load the content as text, content for tooltip & search\n\t\t\t\t\t\tif ( content && content.length > 0 ) {\n\t\t\t\t\t\t\tmode\t= 'replace_content';\n\t\t\t\t\t\t\tvalues\t= $.extend( values, {\n\t\t\t\t\t\t\t\ttext:            content,\n\t\t\t\t\t\t\t\ttooltip_content: content,\n\t\t\t\t\t\t\t\tterm_search:     itge.removeAccents( content.toLowerCase()),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmode\t= 'add_content';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Then generate form through Ajax\n\t\t\t\tloader = ithoughts.makeLoader();\n\t\t\t\t$.ajax({\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tasync:  true,\n\t\t\t\t\turl:    itge.admin_ajax,\n\t\t\t\t\tdata:   {\n\t\t\t\t\t\taction:\t  'ithoughts_tt_gl_get_tinymce_tooltip_form',\n\t\t\t\t\t\tdata:     values,\n\t\t\t\t\t\t_wpnonce: itge.nonce,\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: function success( out ) {\n\t\t\t\t\t\tloader.remove();\n\t\t\t\t\t\tvar newDom = $( $.parseHTML( out, true ));\n\t\t\t\t\t\t$( document.body ).append( newDom.css({\n\t\t\t\t\t\t\topacity: 1,\n\t\t\t\t\t\t}).animate({\n\t\t\t\t\t\t\topacity: 1,\n\t\t\t\t\t\t}, 500 ));\n\n\n\t\t\t\t\t\titge.finishTipTinymce = ( function finishTipTinymce() {\n\t\t\t\t\t\t\tvar domC = newDom;\n\t\t\t\t\t\t\treturn function handleFormSubmitted( data ) {\n\t\t\t\t\t\t\t\titge.info( 'New tooltip data:', data );\n\t\t\t\t\t\t\t\tdomC.animate({\n\t\t\t\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\t\t\t}, 500, function animateAfter() {\n\t\t\t\t\t\t\t\t\tdomC.remove();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif ( 'undefined' === typeof data || null === data ) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvar optsStrs\t\t= [],\n\t\t\t\t\t\t\t\t\tattributesList\t= domC.find( '#attributes-list option' ).map( function domToValue() {\n\t\t\t\t\t\t\t\t\t\treturn this.value;\n\t\t\t\t\t\t\t\t\t}).toArray(),\n\t\t\t\t\t\t\t\t\topts\t\t\t= data.opts || values.opts,\n\t\t\t\t\t\t\t\t\taddOpt\t\t\t= ( label, value, specEncode ) => {\n\t\t\t\t\t\t\t\t\t\toptsStrs.push( generateAttr( label, value, specEncode ));\n\t\t\t\t\t\t\t\t\t\toptsStrs = optsStrs.filter( function filterNoNA( val ) {\n\t\t\t\t\t\t\t\t\t\t\treturn !isNA( val );\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tmy,\n\t\t\t\t\t\t\t\t\ttypes\t\t\t= [ 'span', 'link' ],\n\t\t\t\t\t\t\t\t\ttypesLength\t\t= types.length,\n\t\t\t\t\t\t\t\t\ti\t\t\t\t= -1,\n\t\t\t\t\t\t\t\t\tj,\n\t\t\t\t\t\t\t\t\tprefix,\n\t\t\t\t\t\t\t\t\tmidPart,\n\t\t\t\t\t\t\t\t\toptsAttrs\t\t= ( opts && opts.attributes ) || {},\n\t\t\t\t\t\t\t\t\tshortcode\t\t= `${ prefix4  }-${  data.type }`,\n\t\t\t\t\t\t\t\t\ttail\t\t\t= ( mode !== 'load' && 0 === content.length ) ? ' ' : '';\n\n\t\t\t\t\t\t\t\tif ( !isNA( opts )) {\n\t\t\t\t\t\t\t\t\tif ( opts['qtip-content']) {\n\t\t\t\t\t\t\t\t\t\taddOpt( 'data-termcontent', opts['qtip-content']);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( opts['qtip-keep-open']) {\n\t\t\t\t\t\t\t\t\t\taddOpt( 'data-qtip-keep-open', 'true' );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( !isNA( opts.qtiprounded )) {\n\t\t\t\t\t\t\t\t\t\taddOpt( 'data-qtiprounded', String( opts.qtiprounded ));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( !isNA( opts.qtipshadow )) {\n\t\t\t\t\t\t\t\t\t\taddOpt( 'data-qtipshadow', String( opts.qtipshadow ));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( opts.qtipstyle ) {\n\t\t\t\t\t\t\t\t\t\taddOpt( 'data-qtipstyle', opts.qtipstyle );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( opts.qtiptrigger ) {\n\t\t\t\t\t\t\t\t\t\taddOpt( 'data-qtiptrigger', opts.qtiptrigger );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( opts.position ) {\n\t\t\t\t\t\t\t\t\t\tif ( opts.position.at && opts.position.at[1] && opts.position.at[2]) {\n\t\t\t\t\t\t\t\t\t\t\taddOpt( 'data-position-at', `${ opts.position.at[1]  } ${  opts.position.at[2] }` );\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif ( opts.position.my && opts.position.my[1] && opts.position.my[2]) {\n\t\t\t\t\t\t\t\t\t\t\tmy = [ opts.position.my[1], opts.position.my[2] ];\n\t\t\t\t\t\t\t\t\t\t\tif ( opts.position.my.invert ) {\n\t\t\t\t\t\t\t\t\t\t\t\tmy.reverse();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\taddOpt( 'data-position-my', my.join( ' ' ));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( opts.anim ) {\n\t\t\t\t\t\t\t\t\t\tif ( opts.anim['in']) {\n\t\t\t\t\t\t\t\t\t\t\taddOpt( 'data-animation_in', opts.anim['in']);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif ( opts.anim.out ) {\n\t\t\t\t\t\t\t\t\t\t\taddOpt( 'data-animation_out', opts.anim.out );\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tif ( opts.anim.time ) {\n\t\t\t\t\t\t\t\t\t\t\taddOpt( 'data-animation_time', opts.anim.time );\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( opts.maxwidth ) {\n\t\t\t\t\t\t\t\t\t\taddOpt( 'data-tooltip-maxwidth', opts.maxwidth );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\twhile ( i++ < typesLength ) {\n\t\t\t\t\t\t\t\t\t\tvar type = types[i];\n\t\t\t\t\t\t\t\t\t\tif ( optsAttrs.hasOwnProperty( type )) {\n\t\t\t\t\t\t\t\t\t\t\tfor ( j in optsAttrs[type]) {\n\t\t\t\t\t\t\t\t\t\t\t\tif ( optsAttrs[type].hasOwnProperty( j )) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprefix = attributesList.indexOf( j ) > -1 && !j.startsWith( 'data-' ) ? '' : 'data-';\n\t\t\t\t\t\t\t\t\t\t\t\t\tmidPart = 'link' === type ? 'link-' : '';\n\t\t\t\t\t\t\t\t\t\t\t\t\taddOpt( prefix + midPart + j, optsAttrs[type][j], true );\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ( data.link ) {\n\t\t\t\t\t\t\t\t\taddOpt( 'href', encodeURI( data.link ));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ( 'glossary' === data.type ) {\n\t\t\t\t\t\t\t\t\tif ( !data.glossary_id || !data.text ) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\taddOpt( 'glossary-id', data.glossary_id );\n\t\t\t\t\t\t\t\t\t\tif ( data.disable_auto_translation ) {\n\t\t\t\t\t\t\t\t\t\t\taddOpt( 'disable_auto_translation', 'true' );\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else if ( 'tooltip' === data.type ) {\n\t\t\t\t\t\t\t\t\tif ( !data.tooltip_content || !data.text ) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\taddOpt( 'tooltip-content', escapeContent ? data.tooltip_content.replace( /</g, '&lt;' ).replace( />/g, '&gt;' ) : data.tooltip_content, true );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else if ( 'mediatip' === data.type ) {\n\t\t\t\t\t\t\t\t\tif ( !data.mediatip_type || !data.mediatip_content || !data.text ) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\taddOpt( 'mediatip-type', data.mediatip_type );\n\t\t\t\t\t\t\t\t\t\taddOpt( 'mediatip-content', data.mediatip_content, true );\n\t\t\t\t\t\t\t\t\t\tif ( data.mediatip_caption ) {\n\t\t\t\t\t\t\t\t\t\t\taddOpt( 'mediatip-caption', data.mediatip_caption, true );\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvar finalContent = `[${  shortcode  } ${  optsStrs.join( ' ' )  }]${  data.text  }[/${  shortcode  }]${  tail }`;\n\t\t\t\t\t\t\t\titge.log( 'Final content:', finalContent );\n\t\t\t\t\t\t\t\treturn callback( finalContent, mode );\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}());\n\t\t\t\t\t},\n\t\t\t\t\terror: function error( xhr ) {\n\t\t\t\t\t\tloader.remove();\n\t\t\t\t\t\titge.error( 'Error while getting TinyMCE form for Tip: ', arguments );\n\t\t\t\t\t\tif ( 403 === xhr.status ) {\n\t\t\t\t\t\t\t$( $.parseHTML( `<p>${ editor.getLang( 'ithoughts_tt_gl_tinymce.error.forbidden.content_1' ) }<br/><a href=\"javascript:window.location.href=window.location.href\">${ editor.getLang( 'ithoughts_tt_gl_tinymce.error.forbidden.content_2' ) }</a></p>` )).dialog({\n\t\t\t\t\t\t\t\ttitle:  editor.getLang( 'ithoughts_tt_gl_tinymce.error.forbidden.title' ),\n\t\t\t\t\t\t\t\tmodale: true,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t};\n\n\t\tfunction generateSelObject() {\n\t\t\tvar txtarea = $( '#content' ).get( 0 );\n\t\t\tvar sel = {\n\t\t\t\thtml: itge.replaceShortcodes( txtarea.value.substring( txtarea.selectionStart, txtarea.selectionEnd )),\n\t\t\t};\n\t\t\tsel.DOM = $.parseHTML( sel.html );\n\t\t\tsel.start = $( sel.DOM ).first().get( 0 );\n\t\t\tsel.end = $( sel.DOM ).last().get( 0 );\n\t\t\treturn sel;\n\t\t}\n\t\tfunction generateAttr( label, value, specEncode ) {\n\t\t\tvalue = String( value ).trim();\n\t\t\tif ( !label.match( /^[\\w_\\-]*$/ )) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn `${ stripQuotes( label.trim(), true )  }=\"${   !isNA( specEncode ) && specEncode ? value.replace( /\"/g, '&aquot;' ).replace( /\\n/g, '<br/>' ) : stripQuotes( value, true )  }\"`;\n\t\t}\n\t\tQTags.addButton( 'ithoughts_tt_gl-tip', 'ITG Tip', function onClickButton() {\n\t\t\titge.editorForms.tip( generateSelObject(), QTags.insertContent, true );\n\t\t});\n\t\tQTags.addButton( 'ithoughts_tt_gl-list', 'ITG List', function onClickButton() {\n\t\t\titge.editorForms.list( generateSelObject(), QTags.insertContent, true );\n\t\t});\n\t});\n})( iThoughts.v5 );\n"]}