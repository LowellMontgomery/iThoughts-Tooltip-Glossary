/*! ithoughts-tooltip-glossary build on 2017-08-29 11:01:00 for v3.0.2 */
/**
 * @file Script loaded as soon a post editor is opened. It contains all basic functions to insert shortcodes
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3
 * @package ithoughts-tooltip-glossary
 *
 * @version 2.7.0
 */
"use strict";!function(a){a.$d.ready(function(){function b(){var a=d("#content").get(0),b={html:f.replaceShortcodes(a.value.substring(a.selectionStart,a.selectionEnd))};return b.DOM=d.parseHTML(b.html),b.start=d(b.DOM).first().get(0),b.end=d(b.DOM).last().get(0),b}function c(a,b,c){return b=String(b).trim(),a.match(/^[\w_\-]*$/)?g(a.trim(),!0)+'="'+(!k(c)&&c?b.replace(/"/g,"&aquot;").replace(/\n/g,"<br/>"):g(b,!0))+'"':null}var d=a.$,e=iThoughtsTooltipGlossary,f=iThoughtsTooltipGlossaryEditor,g=e.stripQuotes,h="ithoughts-tooltip-glossary",i=["ithoughts-tooltip-glossary-term","ithoughts-tooltip-glossary-tooltip","ithoughts-tooltip-glossary-mediatip"],j=["href"],k=a.isNA,l=f.editor;a.initLoggers(f,"iThoughts Tooltip Glossary",f.verbosity),f.removeAccents=function(a){var b=/[¹²³áàâãäåaaaÀÁÂÃÄÅAAAÆccç©CCÇÐÐèéê?ëeeeeeÈÊË?EEEEE€gGiìíîïìiiiÌÍÎÏ?ÌIIIlLnnñNNÑòóôõöoooøÒÓÔÕÖOOOØŒr®Ršs?ßŠS?ùúûüuuuuÙÚÛÜUUUUýÿÝŸžzzŽZZ]/g,c={"¹":"1","²":"2","³":"3","á":"a","à":"a","â":"a","ã":"a","ä":"a","å":"a",a:"a","À":"a","Á":"a","Â":"a","Ã":"a","Ä":"a","Å":"a",A:"a","Æ":"a",c:"c","ç":"c","©":"c",C:"c","Ç":"c","Ð":"d","è":"e","é":"e","ê":"e","?":"s","ë":"e",e:"e","È":"e","Ê":"e","Ë":"e",E:"e","€":"e",g:"g",G:"g",i:"i","ì":"i","í":"i","î":"i","ï":"i","Ì":"i","Í":"i","Î":"i","Ï":"i",I:"i",l:"l",L:"l",n:"n","ñ":"n",N:"n","Ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o",o:"o","ø":"o","Ò":"o","Ó":"o","Ô":"o","Õ":"o","Ö":"o",O:"o","Ø":"o","Œ":"o",r:"r","®":"r",R:"r","š":"s",s:"s","ß":"s","Š":"s",S:"s","ù":"u","ú":"u","û":"u","ü":"u",u:"u","Ù":"u","Ú":"u","Û":"u","Ü":"u",U:"u","ý":"y","ÿ":"y","Ý":"y","Ÿ":"y","ž":"z",z:"z","Ž":"z",Z:"z"};return a.replace(b,function(a){return c[a]})},f.replaceShortcodes=function(a){for(var b=f.replaceShortcodesEl.length,c=-1;(c+=1)<b;)a=f.replaceShortcodesEl[c](a);return a},f.restoreShortcodes=function(a){for(var b=f.restoreShortcodesEl.length,c=-1;(c+=1)<b;)a=f.restoreShortcodesEl[c](a);return a},f.replaceShortcodesEl=[function(a){return a.replace(/\[(?:itg-)?(glossary|tooltip|mediatip)(?!_)(.*?)\](.*?)\[\/(?:itg-)?(glossary|tooltip|mediatip)\]/g,function(a,b,c,d){for(var e,f={},g=/([\w\d\-]+?)="(.+?)"/g,i=null,k='<a data-type="'+h+"-"+{glossary:"term",tooltip:"tooltip",mediatip:"mediatip"}[b]+'"';!0===Boolean(i=g.exec(c));)f[i[1]]=i[2];for(e in f)f.hasOwnProperty(e)&&(j.indexOf(e)>-1||0===e.indexOf("data-")?k+=" "+e+'="'+f[e]+'"':k+=" data-"+e+'="'+f[e]+'"');return k+">"+d+"</a>"})},function(a){return a.replace(/\[glossary_(term_list|atoz)(.*?)\/\]/g,function(a,b,c){for(var d,e={},f=/([\w\d\-]+?)="(.+?)"/g,g=null,i='<span data-type="'+h+"-"+b+'"';!0===Boolean(g=f.exec(c));)e[g[1]]=g[2];for(d in e)e.hasOwnProperty(d)&&(j.indexOf(d)>-1||0===d.indexOf("data-")?i+=" "+d+'="'+e[d]+'"':i+=" data-"+d+'="'+e[d]+'"');return i+">Glossary "+("term_list"===b?"List":"A-to-Z")+"</span>"})}],f.restoreShortcodesEl=[function(a){return a.replace(/<a\s+(?=[^>]*data-type="ithoughts-tooltip-glossary-(term|tooltip|mediatip)")(.*?)>(.*?)<\/a>/g,function(a,b,c,d){for(var e,f={},g=/(data-)?([\w\d\-]+?)="(.+?)"/g,h=null,i={term:"glossary",tooltip:"tooltip",mediatip:"mediatip"}[b],k="[itg-"+i;!0===Boolean(h=g.exec(c));)"data-"===h[1]&&"type"===h[2]||(j.indexOf(h[2])>-1&&void 0!==h[1]?f[h[1]+h[2]]=h[3]:f[h[2]]=h[3]);for(e in f)f.hasOwnProperty(e)&&(k+=" "+e+'="'+f[e]+'"');return k+"]"+d+"[/itg-"+i+"]"})},function(a){return a.replace(/<span\s+(?=[^>]*data-type="ithoughts-tooltip-glossary-(term_list|atoz)")(.*?)>.*?<\/span>/g,function(a,b,c){for(var d,e={},f=/(data-)?([\w\d\-]+?)="(.+?)"/g,g=null,h="[glossary_"+b;!0===Boolean(g=f.exec(c));)"data-"===g[1]&&"type"===g[2]||(j.indexOf(d)>-1&&void 0!==g[1]?e[g[1]+g[2]]=g[3]:e[g[2]]=g[3]);for(d in e)e.hasOwnProperty(d)&&(h+=" "+d+'="'+e[d]+'"');return h+"/]"})}],f.editorForms={list:function(b,e){function g(a){return(a||"").split(",").map(Function.prototype.call,String.prototype.trim).filter(function(a){return a})}f.log("Selection infos to load TIP: ",b);var h,i="insert_content",j=b.start,l={type:"atoz",alpha:[],group:[]};k(b.start)||b.start!==b.end||(f.log("Start & End node are the same, operating on a node of type "+j.nodeName),j&&"#text"!==j.nodeName&&(d.extend(l,{alpha:g(j.getAttribute("data-alpha")),group:g(j.getAttribute("data-group"))}),"ithoughts-tooltip-glossary-atoz"===j.getAttribute("data-type")?(i="load",l.type="atoz"):"ithoughts-tooltip-glossary-term_list"===j.getAttribute("data-type")&&(i="load",l.type="list",d.extend(l,{cols:parseInt(j.getAttribute("data-cols")),desc:j.getAttribute("data-desc")})))),h=a.makeLoader(),d.ajax({method:"POST",async:!0,url:f.admin_ajax,data:{action:"ithoughts_tt_gl_get_tinymce_list_form",data:l,_wpnonce:f.nonce},success:function(a){h.remove();var b=d(d.parseHTML(a,!0));d(document.body).append(b.css({opacity:0}).animate({opacity:1},500)),f.finishListTinymce=function(){var a=b;return function(b){if(f.info("New list data:",b),a.animate({opacity:0},500,function(){a.remove()}),void 0!==b){var d="glossary_"+{atoz:"atoz",list:"term_list"}[b.type],g="load"!==i?" ":"",h=[],j=["alpha","group"];switch(b.type){case"list":j=j.concat(["cols","desc"])}for(var l=0,m=j.length;l<m;l++){var n=j[l];b.hasOwnProperty(n)&&function(a,b,d){h.push(c(a,b,d)),h=h.filter(function(a){return!k(a)})}(n,b[n])}var o="["+d+" "+h.join(" ")+"/]"+g;return f.log("Final content:",o),e(o,i)}}}()},error:function(){h.remove(),f.error("Error while getting TinyMCE form for Tip: ",arguments)}})},tip:function(b,e,h){f.info("Selection infos to load TIP: ",b);var j,m,n,o,p,q,r,s,t,u,v,w={},x=b.start,y="",z=-1;if(!k(b.start)&&b.start===b.end)if(f.log("Start & End node are the same, operating on a node of type "+x.nodeName),j=x&&x.text||b.html,f.log("Loading content: ",j),x&&"#text"!==x.nodeName&&i.indexOf(x.getAttribute("data-type"))>-1){for(y="load",o={},m=x.attributes,n=m.length;(z+=1)<n;)p=m[z],o[p.nodeName]=p.nodeValue;q=function(a,b){!k(b)&&b||(a="data-"+a);var c=o[a];return delete o[a],c},r=(q("position-at")||" ").split(" "),s=(q("position-my")||" ").split(" "),t=1===Math.max(s.indexOf("top"),s.indexOf("bottom"))||0===Math.max(s.indexOf("right"),s.indexOf("left")),r={1:r[0],2:r[1]},s={1:s[t?1:0],2:s[t?0:1],invert:t?"enabled":void 0},u=function(a){return"true"===a||"false"!==a&&null};var A=q("tooltip-content");h&&A&&(A=A.replace(/&lt;/g,"<").replace(/&gt;/g,">")),w={text:j,link:q("href",!0),tooltip_content:g(A||j,!1),glossary_id:q("glossary-id"),term_search:f.removeAccents(j.toLowerCase()),mediatip_type:q("mediatip-type"),mediatip_content:g(q("mediatip-content"),!1),mediatip_link:q("mediatip-link"),mediatip_caption:q("mediatip-caption"),type:["glossary","tooltip","mediatip"][i.indexOf(q("type"))],opts:{termcontent:q("termcontent"),"qtip-keep-open":"true"===q("qtip-keep-open"),qtiprounded:u(q("qtiprounded")),qtipshadow:u(q("qtipshadow")),qtipstyle:q("qtipstyle"),qtiptrigger:q("qtiptrigger"),position:{at:r,my:s},attributes:{span:{},link:{}},anim:{in:q("animation_in"),out:q("animation_out"),time:q("animation_time")},maxwidth:q("tooltip-maxwidth")},glossary_disable_auto_translation:"true"===(q("disable_auto_translation")||!1)};for(z in o)o.hasOwnProperty(z)&&(z.match(/^data-link-/)?w.opts.attributes.link[z.replace(/^data-link-(data-)?/,"")]=o[z]:w.opts.attributes.span[z.replace(/^data-/,"")]=o[z])}else w={text:"",link:"",tooltip_content:"",glossary_id:null,term_search:"",mediatip_type:"",mediatip_content:"",mediatip_caption:"",type:"tooltip",glossary_disable_auto_translation:!1},j&&j.length>0?(y="replace_content",w=d.extend(w,{text:j,tooltip_content:j,term_search:f.removeAccents(j.toLowerCase())})):y="add_content";v=a.makeLoader(),d.ajax({method:"POST",async:!0,url:f.admin_ajax,data:{action:"ithoughts_tt_gl_get_tinymce_tooltip_form",data:w,_wpnonce:f.nonce},success:function(a){v.remove();var b=d(d.parseHTML(a,!0));d(document.body).append(b.css({opacity:1}).animate({opacity:1},500)),f.finishTipTinymce=function(){var a=b;return function(b){if(f.info("New tooltip data:",b),a.animate({opacity:0},500,function(){a.remove()}),void 0!==b&&null!==b){var d,g,i,l,m=[],n=a.find("#attributes-list option").map(function(){return this.value}).toArray(),o=b.opts||w.opts,p=function(a,b,d){m.push(c(a,b,d)),m=m.filter(function(a){return!k(a)})},q=["span","link"],r=q.length,s=-1,t=o&&o.attributes||{},u="itg-"+b.type,v="load"!==y&&0===j.length?" ":"";if(!k(o))for(o["qtip-content"]&&p("data-termcontent",o["qtip-content"]),o["qtip-keep-open"]&&p("data-qtip-keep-open","true"),k(o.qtiprounded)||p("data-qtiprounded",String(o.qtiprounded)),k(o.qtipshadow)||p("data-qtipshadow",String(o.qtipshadow)),o.qtipstyle&&p("data-qtipstyle",o.qtipstyle),o.qtiptrigger&&p("data-qtiptrigger",o.qtiptrigger),o.position&&(o.position.at&&o.position.at[1]&&o.position.at[2]&&p("data-position-at",o.position.at[1]+" "+o.position.at[2]),o.position.my&&o.position.my[1]&&o.position.my[2]&&(d=[o.position.my[1],o.position.my[2]],o.position.my.invert&&d.reverse(),p("data-position-my",d.join(" ")))),o.anim&&(o.anim.in&&p("data-animation_in",o.anim.in),o.anim.out&&p("data-animation_out",o.anim.out),o.anim.time&&p("data-animation_time",o.anim.time)),o.maxwidth&&p("data-tooltip-maxwidth",o.maxwidth);s++<r;){var x=q[s];if(t.hasOwnProperty(x))for(g in t[x])t[x].hasOwnProperty(g)&&(i=n.indexOf(g)>-1&&!g.startsWith("data-")?"":"data-",l="link"===x?"link-":"",p(i+l+g,t[x][g],!0))}if(b.link&&p("href",encodeURI(b.link)),"glossary"===b.type){if(!b.glossary_id||!b.text)return;p("glossary-id",b.glossary_id),b.disable_auto_translation&&p("disable_auto_translation","true")}else if("tooltip"===b.type){if(!b.tooltip_content||!b.text)return;p("tooltip-content",h?b.tooltip_content.replace(/</g,"&lt;").replace(/>/g,"&gt;"):b.tooltip_content,!0)}else if("mediatip"===b.type){if(!(b.mediatip_type&&b.mediatip_content&&b.text))return;p("mediatip-type",b.mediatip_type),p("mediatip-content",b.mediatip_content,!0),b.mediatip_caption&&p("mediatip-caption",b.mediatip_caption,!0)}var z="["+u+" "+m.join(" ")+"]"+b.text+"[/"+u+"]"+v;return f.log("Final content:",z),e(z,y)}}}()},error:function(a){v.remove(),f.error("Error while getting TinyMCE form for Tip: ",arguments),403===a.status&&d(d.parseHTML("<p>"+l.getLang("ithoughts_tt_gl_tinymce.error.forbidden.content_1")+'<br/><a href="javascript:window.location.href=window.location.href">'+l.getLang("ithoughts_tt_gl_tinymce.error.forbidden.content_2")+"</a></p>")).dialog({title:l.getLang("ithoughts_tt_gl_tinymce.error.forbidden.title"),modale:!0})}})}},QTags.addButton("ithoughts_tt_gl-tip","ITG Tip",function(){f.editorForms.tip(b(),QTags.insertContent,!0)}),QTags.addButton("ithoughts_tt_gl-list","ITG List",function(){f.editorForms.list(b(),QTags.insertContent,!0)})})}(iThoughts.v5);/**/