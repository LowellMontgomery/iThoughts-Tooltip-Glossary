{"version":3,"sources":["../../build/js/updater.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","module","selfCalling","ithoughts","$","qs","updater","iThoughtsTooltipGlossaryUpdater","pagenow","progress","text","initData","verboseArea","updaterSection","printError","error","data","stack","JSON","stringify","append","runUpdate","progression","post","iThoughtsTooltipGlossary","admin_ajax","action","versions","maxAdvancement","max","onUpdateRun","out","parentElement","scrollTop","scrollHeight","clientHeight","scrollValOld","value","innerHTML","parseInt","slice","verbose","j","parseHTML","type","from","targetversion","newversion","onUpdateDone","serverResponse","success","initUpdate","messageEnd","title","onUpdateInit","Ended","postboxes","add_postbox_toggles","iThoughts","v5"],"mappings":"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","file":"updater.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/**\n * @file Handles the dialog logic between server updates operations and client\n *\n * @author Gerkin\n * @copyright 2016 GerkinDevelopment\n * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3\n * @package ithoughts-tooltip-glossary\n *\n * @version 2.7.0\n */\n\n'use strict';\n\n/* global postboxes:false, iThoughtsTooltipGlossaryUpdater: false */\n\n( function selfCalling( ithoughts ) {\n\n\tvar $\t\t= ithoughts.$,\n\t\tqs\t\t= ithoughts.qs,\n\t\tupdater\t= iThoughtsTooltipGlossaryUpdater,\n\t\tpagenow\t= updater.pagenow,\n\t\tprogress,\n\t\ttext,\n\t\tinitData,\n\t\tverboseArea,\n\t\tupdaterSection;\n\tdelete updater.pagenow;\n\n\tfunction printError( error, data ) {\n\t\tverboseArea = `<div class=\"update-nag error\">\\\n<p>An error occured during the update. Please see below for details</p>\\\n</div>\\\n<div class=\"verboseContainer postbox\">\\\n<div class=\"handlediv\"></div><h4 class=\"hndle ui-sortable-handle\">Logs</h4>\\\n<div class=\"inside\">\\\n<pre class=\"verboseArea\">${ error.stack }\\\nResponse from server: ${ JSON.stringify( data, null, 4 ) }</pre>\\\n</div>\\\n</div>`;\n\t\tupdaterSection.append( verboseArea );\n\t}\n\n\tfunction runUpdate( progression ) {\n\t\t$.post( iThoughtsTooltipGlossary.admin_ajax, {\n\t\t\taction: 'ithoughts_tt_gl_update',\n\t\t\tdata:   {\n\t\t\t\tversions:       updater,\n\t\t\t\tprogression:    progression,\n\t\t\t\tmaxAdvancement: initData.max,\n\t\t\t},\n\t\t}, function onUpdateRun( out ) {\n\t\t\tif ( verboseArea.parentElement.scrollTop > ( verboseArea.parentElement.scrollHeight - verboseArea.parentElement.clientHeight ) - 50 ) {\n\t\t\t\tverboseArea.parentElement.scrollTop = verboseArea.parentElement.scrollHeight;\n\t\t\t}\n\t\t\tvar scrollValOld = ( verboseArea.parentElement.scrollHeight - verboseArea.parentElement.clientHeight );\n\t\t\ttry {\n\t\t\t\tprogress.value = out.data.progression;\n\t\t\t\ttext.innerHTML = `${ progress.value  }/${  initData.max  } (<em>${  ( `${ parseInt(( progress.value / initData.max ) * 100 )  }` ).slice( 0, 3 )  }%</em>)`;\n\t\t\t\tif ( out.data.verbose ) {\n\t\t\t\t\tfor ( var i = 0, j = out.data.verbose.length; i < j; i++ ) {\n\t\t\t\t\t\t$( verboseArea ).append( $.parseHTML( `<p class=\"${  out.data.verbose[i].type  }\">${  out.data.verbose[i].text  }</p>` ));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( verboseArea.parentElement.scrollTop > scrollValOld - 50 ) {\n\t\t\t\t\tverboseArea.parentElement.scrollTop = verboseArea.parentElement.scrollHeight;\n\t\t\t\t}\n\t\t\t\tif ( out.data.progression < initData.max ) {\n\t\t\t\t\trunUpdate( out.data.progression );\n\t\t\t\t} else {\n\t\t\t\t\tupdater.from = initData.targetversion;\n\t\t\t\t\tithoughts.$.post( iThoughtsTooltipGlossary.admin_ajax, {\n\t\t\t\t\t\taction: 'ithoughts_tt_gl_update_done',\n\t\t\t\t\t\tdata:   {\n\t\t\t\t\t\t\tnewversion: updater.from,\n\t\t\t\t\t\t},\n\t\t\t\t\t}, function onUpdateDone( serverResponse ) {\n\t\t\t\t\t\tif ( serverResponse.success ) {\n\t\t\t\t\t\t\tinitUpdate( updater );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar messageEnd = `<hr/><h4>${ out.data.title }</h4><p>${ out.data.text }</p>`;\n\t\t\t\t\t\t\tupdaterSection.append( messageEnd );\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch ( e ) {\n\t\t\t\tprintError( e, out );\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction initUpdate( versions ) {\n\t\t$.post( iThoughtsTooltipGlossary.admin_ajax, {\n\t\t\taction: 'ithoughts_tt_gl_update',\n\t\t\tdata:   {\n\t\t\t\tversions:       versions,\n\t\t\t\tprogression:    -1,\n\t\t\t\tmaxAdvancement: -1,\n\t\t\t},\n\t\t}, function onUpdateInit( out ) {\n\t\t\tupdaterSection = $( '#Updater' );\n\t\t\ttry {\n\t\t\t\tif ( 'undefined' === typeof out || 'undefined' === typeof out.data ) {\n\t\t\t\t\tthrow new Error( 'Empty server response' );\n\t\t\t\t}\n\t\t\t\tverboseArea = '<div class=\"verboseContainer postbox closed\"><div class=\"handlediv\" title=\"Cliquer pour inverser.\"></div><h4 class=\"hndle ui-sortable-handle\">Logs</h4><div class=\"inside\"><pre class=\"verboseArea\">';\n\t\t\t\tif ( out.data.verbose ) {\n\t\t\t\t\tfor ( var i = 0, j = out.data.verbose.length; i < j; i++ ) {\n\t\t\t\t\t\tverboseArea += `<p class=\"${  out.data.verbose[i].type  }\">${  out.data.verbose[i].text  }</p>`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tverboseArea += '</pre></div></div>';\n\t\t\t\tif ( out.data.Ended ) {\n\t\t\t\t\tupdaterSection.append( $.parseHTML( `<article data-version=\"ended\"><h3>${  out.data.title  }</h3><p class=\"updatedescription\">${  out.data.text  }</p></article>` ));\n\t\t\t\t\tpostboxes.add_postbox_toggles( pagenow );\n\t\t\t\t} else {\n\t\t\t\t\tupdaterSection.append( $.parseHTML( `<article data-version=\"${  out.data.targetversion  }\"><h3>V${  out.data.targetversion  }</h3><p class=\"updatedescription\">${  out.data.text  }</p><progress class=\"updateprogress\" min=\"0\" max=\"${  out.data.max  }\" value=\"0\"></progress><span class=\"updateprogresstext\">0/${  out.data.max  } (<em>0%</em>)</span>${  verboseArea  }</article>` ));\n\t\t\t\t\tpostboxes.add_postbox_toggles( pagenow );\n\t\t\t\t\tinitData = out.data;\n\t\t\t\t\tprogress = qs( `[data-version=\"${  out.data.targetversion  }\"] .updateprogress` );\n\t\t\t\t\ttext = qs( `[data-version=\"${  out.data.targetversion  }\"] .updateprogresstext` );\n\t\t\t\t\tverboseArea = qs( `[data-version=\"${  out.data.targetversion  }\"] .verboseArea` );\n\n\t\t\t\t\trunUpdate( 0 );\n\t\t\t\t}\n\t\t\t} catch ( e ) {\n\t\t\t\tprintError( e, out );\n\t\t\t}\n\t\t});\n\t}\n\tinitUpdate( updater );\n})( iThoughts.v5 );\n\n},{}]},{},[1]);\n"]}